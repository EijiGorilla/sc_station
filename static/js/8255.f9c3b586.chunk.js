"use strict";(self.webpackChunksc_station=self.webpackChunksc_station||[]).push([[8255,5617,3391],{35617:(e,t,i)=>{i.r(t),i.d(t,{hydratedAdapter:()=>l});var r=i(76797),n=i(66388),s=i(19247),a=i(65215),o=i(23701);const l={convertToGEGeometry:function(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){const r=e.hasZ(t),n=e.hasM(t),a=new s.A({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(a.z=e.getPointZ(t)),n&&(a.m=e.getPointM(t)),a.cache._geVersion=t,a},exportPolygon:function(e,t,i){const r=new a.A({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportPolyline:function(e,t,i){const r=new o.A({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportMultipoint:function(e,t,i){const r=new n.A({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r},exportExtent:function(e,t,i){const n=e.hasZ(t),s=e.hasM(t),a=new r.A({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(n){const i=e.getZExtent(t);a.zmin=i.vmin,a.zmax=i.vmax}if(s){const i=e.getMExtent(t);a.mmin=i.vmin,a.mmax=i.vmax}return a.cache._geVersion=t,a}}},63391:(e,t,i)=>{i.r(t),i.d(t,{buffer:()=>C,changeDefaultSpatialReferenceTolerance:()=>N,clearDefaultSpatialReferenceTolerance:()=>j,clip:()=>o,contains:()=>c,convexHull:()=>M,crosses:()=>h,cut:()=>l,densify:()=>k,difference:()=>V,disjoint:()=>_,distance:()=>d,equals:()=>u,extendedSpatialReferenceInfo:()=>a,flipHorizontal:()=>Z,flipVertical:()=>F,generalize:()=>x,geodesicArea:()=>U,geodesicBuffer:()=>R,geodesicDensify:()=>z,geodesicLength:()=>I,intersect:()=>A,intersectLinesToPoints:()=>B,intersects:()=>p,isSimple:()=>g,nearestCoordinate:()=>S,nearestVertex:()=>T,nearestVertices:()=>E,offset:()=>O,overlaps:()=>m,planarArea:()=>G,planarLength:()=>L,relate:()=>w,rotate:()=>H,simplify:()=>y,symmetricDifference:()=>b,touches:()=>v,union:()=>D,within:()=>f});var r=i(52612),n=i(35617);function s(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function a(e){return r.G.extendedSpatialReferenceInfo(e)}function o(e,t){return r.G.clip(n.hydratedAdapter,s(e),e,t)}function l(e,t){return r.G.cut(n.hydratedAdapter,s(e),e,t)}function c(e,t){return r.G.contains(n.hydratedAdapter,s(e),e,t)}function h(e,t){return r.G.crosses(n.hydratedAdapter,s(e),e,t)}function d(e,t,i){return r.G.distance(n.hydratedAdapter,s(e),e,t,i)}function u(e,t){return r.G.equals(n.hydratedAdapter,s(e),e,t)}function p(e,t){return r.G.intersects(n.hydratedAdapter,s(e),e,t)}function v(e,t){return r.G.touches(n.hydratedAdapter,s(e),e,t)}function f(e,t){return r.G.within(n.hydratedAdapter,s(e),e,t)}function _(e,t){return r.G.disjoint(n.hydratedAdapter,s(e),e,t)}function m(e,t){return r.G.overlaps(n.hydratedAdapter,s(e),e,t)}function w(e,t,i){return r.G.relate(n.hydratedAdapter,s(e),e,t,i)}function g(e){return r.G.isSimple(n.hydratedAdapter,s(e),e)}function y(e){return r.G.simplify(n.hydratedAdapter,s(e),e)}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.G.convexHull(n.hydratedAdapter,s(e),e,t)}function V(e,t){return r.G.difference(n.hydratedAdapter,s(e),e,t)}function b(e,t){return r.G.symmetricDifference(n.hydratedAdapter,s(e),e,t)}function A(e,t){return r.G.intersect(n.hydratedAdapter,s(e),e,t)}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r.G.union(n.hydratedAdapter,s(e),e,t)}function O(e,t,i,a,o,l){return r.G.offset(n.hydratedAdapter,s(e),e,t,i,a,o,l)}function C(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r.G.buffer(n.hydratedAdapter,s(e),e,t,i,a)}function R(e,t,i,a,o,l){return r.G.geodesicBuffer(n.hydratedAdapter,s(e),e,t,i,a,o,l)}function S(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r.G.nearestCoordinate(n.hydratedAdapter,s(e),e,t,i)}function T(e,t){return r.G.nearestVertex(n.hydratedAdapter,s(e),e,t)}function E(e,t,i,a){return r.G.nearestVertices(n.hydratedAdapter,s(e),e,t,i,a)}function P(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent?.center??null:null}function H(e,t,i){if(null==e)throw new $;const n=e.spatialReference;if(null==(i=i??P(e)))throw new $;const s=e.constructor.fromJSON(r.G.rotate(e,t,i));return s.spatialReference=n,s}function Z(e,t){if(null==e)throw new $;const i=e.spatialReference;if(null==(t=t??P(e)))throw new $;const n=e.constructor.fromJSON(r.G.flipHorizontal(e,t));return n.spatialReference=i,n}function F(e,t){if(null==e)throw new $;const i=e.spatialReference;if(null==(t=t??P(e)))throw new $;const n=e.constructor.fromJSON(r.G.flipVertical(e,t));return n.spatialReference=i,n}function x(e,t,i,a){return r.G.generalize(n.hydratedAdapter,s(e),e,t,i,a)}function k(e,t,i){return r.G.densify(n.hydratedAdapter,s(e),e,t,i)}function z(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return r.G.geodesicDensify(n.hydratedAdapter,s(e),e,t,i,a)}function G(e,t){return r.G.planarArea(n.hydratedAdapter,s(e),e,t)}function L(e,t){return r.G.planarLength(n.hydratedAdapter,s(e),e,t)}function U(e,t,i){return r.G.geodesicArea(n.hydratedAdapter,s(e),e,t,i)}function I(e,t,i){return r.G.geodesicLength(n.hydratedAdapter,s(e),e,t,i)}function B(e,t){return r.G.intersectLinesToPoints(n.hydratedAdapter,s(e),e,t)}function N(e,t){r.G.changeDefaultSpatialReferenceTolerance(e,t)}function j(e){r.G.clearDefaultSpatialReferenceTolerance(e)}class $ extends Error{constructor(){super("Illegal Argument Exception")}}},2522:(e,t,i)=>{i.d(t,{P:()=>l});var r=i(35143),n=i(54901),s=i(91291),a=i(46053),o=(i(81806),i(76460),i(47249),i(85842));const l=e=>{let t=class extends((0,s.g)(e)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return null==this.parent||this.parent.visible&&!this.parent.suspended}set visible(e){this._overrideIfSome("visible",e)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,n.hA)((()=>this._interactiveViewModelCount--))}};return(0,r._)([(0,a.MZ)({constructOnly:!0})],t.prototype,"parent",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,a.MZ)({type:Boolean})],t.prototype,"interactive",null),(0,r._)([(0,a.MZ)()],t.prototype,"_userInteractive",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],t.prototype,"updating",null),(0,r._)([(0,a.MZ)()],t.prototype,"visible",null),(0,r._)([(0,a.MZ)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,r._)([(0,o.$)("esri.views.3d.analysis.AnalysisView3D")],t),t}},93131:(e,t,i)=>{i.d(t,{Bw:()=>_,D9:()=>b,DG:()=>d,E3:()=>C,FF:()=>l,Hb:()=>s,I4:()=>M,Jj:()=>O,Ll:()=>p,NT:()=>m,Sw:()=>S,UF:()=>o,YG:()=>D,ZR:()=>v,aE:()=>T,aj:()=>A,c1:()=>h,cE:()=>c,cO:()=>f,lS:()=>u,qD:()=>w,rb:()=>g,sd:()=>R,vA:()=>V,vo:()=>a,xj:()=>y});var r=i(81806),n=i(15941);const s=(0,r.A)("mac")?"Meta":"Control",a="Shift",o=2,l=1.15,c=1.15,h=2500,d=.02,u=Math.cos((0,n.kU)(45)),p=Math.cos((0,n.kU)(5)),v=.95,f=.3,_=2,m=1,w=3,g=11,y=22.5,M=40,V=48,b=2.25,A=4,D=1,O=.3,C=6,R=4,S=1600,T=.4},87027:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Mt});var r=i(35143),n=i(91967),s=i(30726),a=i(68134),o=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),c=i(2522),h=i(54901),d=i(69539),u=i(53084),p=i(15941),v=i(34761),f=i(13191),_=i(20664),m=i(9392),w=(i(19555),i(72745)),g=i(63391),y=(i(75762),i(38317)),M=i(7947);function V(e,t){let{tiltedUpVector:i,rightVector:r,observerRenderSpace:n}=e;const s=(0,y.wQ)(i,r,n,t);return s[12]=0,s[13]=0,s[14]=0,s}function b(e,t,i){const r=(0,m.vt)(),n=(0,_.b)((0,m.vt)(),i.basis1,i.basis2);return e.next((0,M.AA)(t,i.plane)).next((e=>{"start"===e.action&&(0,_.c)(r,e.renderStart);const t=(0,p.KJ)((0,y.FY)(r,e.renderEnd,i.origin,n));return{...e,deltaAngle:t}}))}function A(e,t){if(null==e)return 0;const{observer:i,target:r}=e,n=t.camera.position,s=(0,g.distance)(n,i)>(0,g.distance)(n,r)?i:r;return t.pixelSizeAt(s)}(0,w.vt)();var D=i(7256),O=i(45463),C=i(35925);const R=new d.A([85,85,85,.5]);let S=class extends n.A{constructor(e){super(e),this.visible=!0,this._viewshedCorners={topLeft:(0,m.vt)(),topRight:(0,m.vt)(),bottomLeft:(0,m.vt)(),bottomRight:(0,m.vt)(),center:(0,m.vt)()},this._arcCenterPoints={top:(0,m.vt)(),bottom:(0,m.vt)(),left:(0,m.vt)(),right:(0,m.vt)()},this._parallelCenters={top:(0,m.vt)(),bottom:(0,m.vt)()}}initialize(){const e={view:this.view,isDecoration:!0,color:this._color,renderOccluded:O.m$.OccludeAndTransparent},t={...e,width:2,stipplePattern:(0,C.wk)(2)};this._boundaryLinesVisualElement=new D.t(e),this._leftArcVisualElement=new D.t(e),this._rightArcVisualElement=new D.t(e),this._topArcVisualElement=new D.t(e),this._bottomArcVisualElement=new D.t(e),this._centralLongitude=new D.t(t),this._centralLatitude=new D.t(t),this.addHandles([(0,a.wB)((()=>{const e=this.viewshedComputedData;if(!e?.isValid())return null;const t=this._offsetScale,i=this._viewshedCorners,r=this._arcCenterPoints,n=this._parallelCenters;return e.cornerPoints(t,i),e.arcCentersPoints(t,r),e.parallelCenterPoints(n),{viewshedComputedData:e,corners:i,arcCenters:r,parallelCenters:n}}),(e=>{null!=e?(this._forEachVisualElement((e=>e.attached=!0)),this._updateVisualElements(e)):this._forEachVisualElement((e=>e.attached=!1))}),{initial:!0,equals:u.aI}),(0,a.wB)((()=>({visible:this.visible,horFOV:this.viewshedComputedData?.horizontalFieldOfView})),((e,t)=>{let{visible:i,horFOV:r}=e;i!==t?.visible&&this._forEachVisualElement((e=>e.visible=i)),i&&r!==t?.horFOV&&(this._boundaryLinesVisualElement.visible=360!==r)}),a.Vh),(0,a.wB)((()=>this._color),(e=>this._forEachVisualElement((t=>t.color=e))),a.Vh)])}get _color(){const e=this.viewshedComputedData;if(null==e)return d.A.toUnitRGBA(R);const t=this.analysisViewData,i=t.tool?.active||t.interactive,r=e===t.selectedViewshedComputedData,n=e.viewshed===t.tool?.stagedViewshed,s=i&&(r||n)?this.view.effectiveTheme.accentColor:R;return d.A.toUnitRGBA(s)}get _offsetScale(){return A(this.viewshedComputedData,this.view)}destroy(){this._boundaryLinesVisualElement=(0,s.pR)(this._boundaryLinesVisualElement),this._leftArcVisualElement=(0,s.pR)(this._leftArcVisualElement),this._rightArcVisualElement=(0,s.pR)(this._rightArcVisualElement),this._topArcVisualElement=(0,s.pR)(this._topArcVisualElement),this._bottomArcVisualElement=(0,s.pR)(this._bottomArcVisualElement),this._centralLongitude=(0,s.pR)(this._centralLongitude),this._centralLatitude=(0,s.pR)(this._centralLatitude)}_forEachVisualElement(e){[this._boundaryLinesVisualElement,this._leftArcVisualElement,this._rightArcVisualElement,this._topArcVisualElement,this._bottomArcVisualElement,this._centralLatitude,this._centralLongitude].forEach(e)}_updateVisualElements(e){const{viewshedComputedData:t,corners:i,arcCenters:r,parallelCenters:n}=e;this._updateBoundaryLines(i),this._updateBoundaryArcs(t,i,n),this._updateCentralHelperArcs(t,r)}_updateBoundaryLines(e){this._boundaryLinesVisualElement.geometry=[[e.center,e.topLeft],[e.center,e.topRight],[e.center,e.bottomLeft],[e.center,e.bottomRight]]}_updateBoundaryArcs(e,t,i){const{observerRenderSpace:r,rightVector:n,horizontalFieldOfView:s,tiltedUpVector:a}=e,o=(0,p.kU)(s),l=(0,m.vt)(),c=(0,f.vt)();(0,v.$0)(c,o/2,a),(0,_.h)(l,n,c),T(this._leftArcVisualElement,r,t.bottomLeft,t.topLeft,"forward",l),(0,v.$0)(c,-o/2,a),(0,_.s)(l,0,0,0),(0,_.h)(l,n,c),T(this._rightArcVisualElement,r,t.bottomRight,t.topRight,"forward",l);const h=s>180?"backward":"forward";T(this._topArcVisualElement,i.top,t.topRight,t.topLeft,h,a),T(this._bottomArcVisualElement,i.bottom,t.bottomRight,t.bottomLeft,h,a)}_updateCentralHelperArcs(e,t){const i=e.observerRenderSpace,r=e.horizontalFieldOfView>=180?"backward":"forward";T(this._centralLatitude,i,t.right,t.left,r,e.tiltedUpVector),T(this._centralLongitude,i,t.top,t.bottom,"forward",e.leftVector)}};function T(e,t,i,r,n,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5;const o=(0,m.vt)();(0,_.z)(o,i,t);const l=(0,_.H)(o),c=(0,m.vt)();(0,_.z)(c,r,t),(0,_.n)(c,c),(0,_.j)(c,c,l);let h=(0,_.d)(o,c);const d=(0,m.o8)(s);"backward"===n&&((0,_.k)(d,d),h=-(2*Math.PI-h));const u=[],w=Math.ceil(Math.abs(h)/(0,p.kU)(a)),g=(0,f.vt)();(0,v.$0)(g,h/w,d);const y=(0,m.vt)();(0,_.c)(y,o);const M=(0,m.vt)();(0,_.c)(M,i);for(let p=0;p<w;p++){const e=(0,m.vt)();(0,_.c)(e,M),(0,_.h)(y,y,g),(0,_.g)(M,t,y);const i=(0,m.vt)();(0,_.c)(i,M),u.push([e,i])}e.geometry=u}(0,r._)([(0,o.MZ)()],S.prototype,"view",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"viewshedComputedData",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"visible",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"_color",null),(0,r._)([(0,o.MZ)()],S.prototype,"_offsetScale",null),S=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedVisualization")],S);const E=S;let P=class extends n.A{get visible(){return this.analysisViewData.visible}constructor(e){super(e)}initialize(){const e=this.analysisViewData,t=(0,a.LF)((()=>this.analysisViewData.viewshedComputedDataHandles),(t=>{let{viewshedComputedData:i}=t;const r=new E({view:this.view,viewshedComputedData:i,analysisViewData:e});return{visualization:r,remove:()=>r.destroy()}}));this._viewshedVisualizations=t,this.addHandles([(0,h.DQ)(t),(0,a.wB)((()=>this.visible),(e=>this._viewshedVisualizations.forEach((t=>{let{visualization:i}=t;return i.visible=e}))))])}};(0,r._)([(0,o.MZ)({constructOnly:!0})],P.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],P.prototype,"view",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],P.prototype,"isDecoration",void 0),(0,r._)([(0,o.MZ)()],P.prototype,"visible",null),P=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedAnalysisVisualization")],P);i(35238);var H,Z=i(19247);let F=H=class extends n.A{constructor(e){super(e)}get observer(){return this.viewshed.observer??new Z.A}get farDistance(){return this.viewshed.farDistance}get farDistanceRenderSpace(){return this.farDistance/this.metersPerUnit}get heading(){return this.viewshed.heading}get tilt(){return this.viewshed.tilt}get tiltParallelToSurface(){return this.tilt-90}get horizontalFieldOfView(){return this.viewshed.horizontalFieldOfView}get verticalFieldOfView(){return this.viewshed.verticalFieldOfView}get observerRenderSpace(){return this._pointToRenderSpace(this.observer,(0,m.vt)())}get target(){const e=this.targetRenderSpace;return this.renderSpaceToPoint(e,this.observer.spatialReference)}get targetRenderSpace(){const{leftVector:e,northVector:t,upVector:i}=this,r=this.observerRenderSpace,n=this.farDistanceRenderSpace,s=(0,m.vt)();return(0,_.j)(s,t,n),k(s,-(0,p.kU)(this.heading),i,s),k(s,-(0,p.kU)(this.tiltParallelToSurface),e,s),(0,_.g)(s,r,s),s}get targetDirection(){const e=(0,_.z)((0,m.vt)(),this.targetRenderSpace,this.observerRenderSpace);return(0,_.n)(e,e)}get tiltedUpVector(){const e=k(this.upVector,-(0,p.kU)(this.tiltParallelToSurface),this.leftVector,(0,m.vt)());return(0,_.n)(e,e)}get _basis(){return this.renderCoordsHelper.basisMatrixAtPosition(this.observerRenderSpace,(0,f.vt)())}get upVector(){const e=this._basis;return(0,m.fA)(e[8],e[9],e[10])}get northVector(){const e=this._basis;return(0,m.fA)(e[4],e[5],e[6])}get leftVector(){const e=this.upVector,t=k(this.northVector,-(0,p.kU)(this.heading),e,(0,m.vt)());return(0,_.b)(t,e,t)}get rightVector(){return(0,_.k)((0,m.vt)(),this.leftVector)}clone(){return new H({renderCoordsHelper:this.renderCoordsHelper,viewshed:this.viewshed.clone()})}isValid(){return this.viewshed.isValid()}get metersPerUnit(){return this.renderCoordsHelper.spatialReference.metersPerUnit}pointOnSphere(e,t,i){const{observerRenderSpace:r,targetRenderSpace:n}=this,s=(0,_.z)(L,n,r);return k(s,-(0,p.kU)(t),this.leftVector,s),k(s,-(0,p.kU)(e),this.tiltedUpVector,s),(0,_.g)(i,s,r)}cornerPoints(e,t){const i=this.observerRenderSpace,r=this.horizontalFieldOfView/2,n=this.verticalFieldOfView/2,s=this.pointOnSphere(-r,n,K),a=this.pointOnSphere(r,n,q),o=this.pointOnSphere(-r,-n,J),l=this.pointOnSphere(r,-n,Y),c=(0,_.z)(N,s,i),h=(0,_.z)(j,a,i),d=(0,_.z)($,o,i),u=(0,_.z)(W,l,i),{horizontalFieldOfView:p}=this,v=I;x(c,h,s,o,i,e,p,t.topLeft,t.bottomLeft,v);const f=B;x(u,d,a,l,i,e,p,t.topRight,t.bottomRight,f),(0,_.j)(t.center,(0,_.g)(t.center,f,v),.5)}arcCentersPoints(e,t){const i=this.horizontalFieldOfView/2,r=this.verticalFieldOfView/2,n=this.pointOnSphere(0,r,t.top),s=this.pointOnSphere(0,-r,t.bottom),a=this.pointOnSphere(-i,0,t.left),o=this.pointOnSphere(i,0,t.right),{observerRenderSpace:l}=this;G(n,l,e),G(s,l,e),G(a,l,e),G(o,l,e)}parallelCenterPoints(e){const t=this.observerRenderSpace,i=this.farDistanceRenderSpace*Math.sin((0,p.kU)(this.verticalFieldOfView/2)),r=(0,_.j)(L,this.tiltedUpVector,i);(0,_.g)(e.top,t,r),(0,_.z)(e.bottom,t,r)}renderSpaceToPoint(e,t){const i=L;return this.renderCoordsHelper.fromRenderCoords(e,i,t),new Z.A(i[0],i[1],i[2],t)}_pointToRenderSpace(e,t){const i=(0,m.ci)(e.toArray());return this.renderCoordsHelper.toRenderCoords(i,e.spatialReference,t),t}};function x(e,t,i,r,n,s,a,o,l,c){const h=function(e,t,i,r){const n=(0,_.b)(r,e,t);return(0,_.n)(n,n),(0,_.j)(n,n,i),n}(e,t,s,U);(0,_.g)(c,n,h),z(i,e,h,s,a,o),z(r,e,h,s,a,l)}function k(e,t,i,r){return(0,v.$0)(X,t,i),(0,_.h)(r,e,X)}function z(e,t,i,r,n,s){const a=(0,_.n)(L,t);return(0,_.j)(a,a,r),(0,_.g)(s,e,a),0!==n&&360!==n&&(0,_.g)(s,s,i),s}function G(e,t,i){const r=(0,_.z)(L,e,t);(0,_.n)(r,r),(0,_.j)(r,r,i),(0,_.g)(e,e,r)}(0,r._)([(0,o.MZ)()],F.prototype,"renderCoordsHelper",void 0),(0,r._)([(0,o.MZ)()],F.prototype,"viewshed",void 0),(0,r._)([(0,o.MZ)()],F.prototype,"observer",null),(0,r._)([(0,o.MZ)()],F.prototype,"farDistance",null),(0,r._)([(0,o.MZ)()],F.prototype,"farDistanceRenderSpace",null),(0,r._)([(0,o.MZ)()],F.prototype,"heading",null),(0,r._)([(0,o.MZ)()],F.prototype,"tilt",null),(0,r._)([(0,o.MZ)()],F.prototype,"tiltParallelToSurface",null),(0,r._)([(0,o.MZ)()],F.prototype,"horizontalFieldOfView",null),(0,r._)([(0,o.MZ)()],F.prototype,"verticalFieldOfView",null),(0,r._)([(0,o.MZ)()],F.prototype,"observerRenderSpace",null),(0,r._)([(0,o.MZ)()],F.prototype,"target",null),(0,r._)([(0,o.MZ)()],F.prototype,"targetRenderSpace",null),(0,r._)([(0,o.MZ)()],F.prototype,"targetDirection",null),(0,r._)([(0,o.MZ)()],F.prototype,"tiltedUpVector",null),(0,r._)([(0,o.MZ)()],F.prototype,"_basis",null),(0,r._)([(0,o.MZ)()],F.prototype,"upVector",null),(0,r._)([(0,o.MZ)()],F.prototype,"northVector",null),(0,r._)([(0,o.MZ)()],F.prototype,"leftVector",null),(0,r._)([(0,o.MZ)()],F.prototype,"rightVector",null),(0,r._)([(0,o.MZ)()],F.prototype,"isValid",null),(0,r._)([(0,o.MZ)()],F.prototype,"metersPerUnit",null),F=H=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedComputedData")],F);const L=(0,m.vt)(),U=(0,m.vt)(),I=(0,m.vt)(),B=(0,m.vt)(),N=(0,m.vt)(),j=(0,m.vt)(),$=(0,m.vt)(),W=(0,m.vt)(),K=(0,m.vt)(),q=(0,m.vt)(),J=(0,m.vt)(),Y=(0,m.vt)(),X=(0,f.vt)();var Q=i(69098),ee=i(73582),te=i(21403),ie=i(40565);let re=class extends((0,Q.O)(n.A)){constructor(e){super(e),this.observer=null,this.farDistance=1e3,this.heading=0,this.tilt=90,this.horizontalFieldOfView=45,this.verticalFieldOfView=45}isValid(){return null!=this.observer&&this.farDistance>0}equals(e){return(0,s.CM)(this.observer,e.observer)&&this.farDistance===e.farDistance&&this.heading===e.heading&&this.tilt===e.tilt&&this.horizontalFieldOfView===e.horizontalFieldOfView&&this.verticalFieldOfView===e.verticalFieldOfView}};(0,r._)([(0,o.MZ)({type:Z.A})],re.prototype,"observer",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0}})],re.prototype,"farDistance",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0}),(0,te.w)((e=>ee.ie.normalize((0,ie.GB)(e))))],re.prototype,"heading",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180}})],re.prototype,"tilt",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}})],re.prototype,"horizontalFieldOfView",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:180}})],re.prototype,"verticalFieldOfView",void 0),(0,r._)([(0,o.MZ)()],re.prototype,"isValid",null),re=(0,r._)([(0,l.$)("esri.analysis.Viewshed")],re);const ne=re;var se=i(13927),ae=i(18690),oe=i(9624),le=i(64465),ce=i(88321),he=i(79650),de=i(93131);const ue=de.aj,pe=de.UF*ue,ve=.0025,fe=Math.sin((0,p.kU)(2)),_e=de.UF/1.5;var me=i(56121),we=i(91175),ge=i(19112),ye=i(60428),Me=i(62577),Ve=i(86994),be=i(425),Ae=i(17046),De=i(76336);class Oe extends ye.c{constructor(e){super(),this._handles=new ce.A,this._interactive=!0,this._tool=e.tool,this._view=e.view,this._focusedArcMaterial=this._createArcMaterial(!0),this._unfocusedArcMaterial=this._createArcMaterial(!1),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,s.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulators=null}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}createDragPipeline(e,t){const i=Object.values(this._manipulators);return(0,h.vE)(i.map((i=>{let{manipulator:r,side:n}=i;return(0,Ae.Xt)(r,((i,r,s,a,o)=>{const l=function(e,t){let{observerRenderSpace:i,targetDirection:r,tiltedUpVector:n,rightVector:s}=t;const a=Re(e)?s:n;return(0,he.f)(i,r,a)}(n,t);Re(n)?t.horizontalFieldOfView:t.verticalFieldOfView;const c=r.next((e=>({...e,manipulatorType:ge.r.SCALE,side:n}))),h=b(c,this._view,l);e(i,h,s)}))})))}updateManipulatorsTransform(e){this._forEachManipulatorInfo((t=>this._updateArcManipulatorTransform(t,e)))}updateManipulatorVisuals(e){this._forEachManipulatorInfo((t=>this._updateArcManipulatorVisuals(t,e)))}_updateArcManipulatorVisuals(e,t){let{manipulator:i,side:r}=e;const n=[];if(null!=t){if("left"===r&&(t.horizontalFieldOfView<1||t.horizontalFieldOfView>359)||"bottom"===r&&t.verticalFieldOfView<1)return i.renderObjects=[],void(i.collisionType={type:"line",paths:[]});const[e,s]=function(e,t,i){const{horizontalFieldOfView:r,verticalFieldOfView:n}=t,s=Re(e),a=(0,p.kU)((0,p.qE)((s?n:r)/2,0,15)),o=s?1:Math.max(Math.sin((0,p.kU)(90-n/2)),.1),l=Ce(-a/2,a/2,o,[-o,0,0]);return[(0,Me.Z8)(i,l),l]}(r,t,this._unfocusedArcMaterial);n.push(new we.M(e,De.p7.Unfocused),new we.M(e.instantiate({material:this._focusedArcMaterial}),De.p7.Focused)),i.collisionType={type:"line",paths:[s]}}i.renderObjects=n,i.radius=10}_updateArcManipulatorTransform(e,t){let{manipulator:i,side:r}=e;const n=t.horizontalFieldOfView,s=(0,p.kU)(t.verticalFieldOfView/2),a=(0,p.kU)(n/2),o=Re(r);i.location=t.observer;const l=(0,f.vt)(),c=e=>{(0,v.lw)(l,e,l)};c((0,v.i1)(Te,(0,p.kU)(-90))),o||c((0,v.hM)(Te,s));const h=t.farDistanceRenderSpace;c((0,v.CV)(Te,(0,_.s)(Ee,h,h,h))),c((0,v.N9)(Te,function(e){return function(e){switch(e){case"left":return 0;case"bottom":return 1;case"right":return 2;case"top":return 3}}(e)*Se}(r))),c(V(t,Te));const d=(0,_.z)(Ee,t.targetRenderSpace,t.observerRenderSpace);let u,m;if(c((0,v.kN)(Te,d)),o){if(u=a,m=t.tiltedUpVector,0!==n&&360!==n){const e=A(t,this._view);u+=2*Math.tan(e/(2*t.farDistance))}}else m=t.rightVector,u=s;u*="right"===r||"bottom"===r?-1:1;const w=(0,v.$0)(Te,u,m);null!=w&&c(w),i.modelTransform=l}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this.interactive||t.grabbing}))}_createManipulators(){const e=this._createArcManipulator("left"),t=this._createArcManipulator("right"),i=this._createArcManipulator("top"),r=this._createArcManipulator("bottom");this._manipulators={left:e,right:t,top:i,bottom:r};const n=[[r.manipulator,i.manipulator],[e.manipulator,t.manipulator]];n.push(...n.map((e=>{let[t,i]=e;return[i,t]}))),this._handles.add(n.map((e=>{let[t,i]=e;return t.events.on("focus-changed",(e=>{const t="focus"===e.action;i.hovering=t}))})))}_createArcManipulator(e){const t={manipulator:new me.q({view:this._view,autoScaleRenderObjects:!1,worldSized:!0}),side:e};return this._updateArcManipulatorVisuals(t),t}_createArcMaterial(e){const t=e?pe:ue,i=new be.W({renderOccluded:O.m$.OccludeAndTransparent,isDecoration:!0,width:t});return this._handles.add((0,a.wB)((()=>d.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(e=>i.setParameters({color:e})),a.Vh)),i}forEachManipulator(e){Object.values(this._manipulators).forEach((t=>{let{manipulator:i}=t;return e(i,ge.r.SCALE)}))}_forEachManipulatorInfo(e){Object.values(this._manipulators).forEach((t=>e(t)))}}function Ce(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;(0,Ve.vA)(n>1,"createArcPolylineGeometry() needs at least 2 for numVertices");const s=t-e,[a,o,l]=r;if(s<=0||i<=0){const e=.001;return[(0,m.fA)(a,o,l+e),(0,m.fA)(a,o,o+-e)]}const c=[],h=s/n;for(let d=0;d<n;d++){let r=e+d*h;d===n-1&&(r=t);const s=Math.cos(r)*i,u=Math.sin(r)*i,p=(0,m.fA)(s+a,o,u+l);c.push(p)}return c}function Re(e){return"left"===e||"right"===e}const Se=Math.PI/2,Te=(0,f.vt)(),Ee=(0,m.vt)();var Pe=i(95925),He=i(83490),Ze=i(76956);class Fe extends me.q{constructor(e,t,i,r){super({view:e,autoScaleRenderObjects:!1,worldSized:!0,radius:5}),this._handles=new ce.A,this._setupManipulatorVisual(t,i,r)}destroy(){this._handles.remove(),super.destroy()}_setupManipulatorVisual(e,t,i){const r=this._createMaterial(),n=(0,p.kU)(t),s=e?1:Math.sin(n),a=e?Ce(0,n,s,[-s,0,0]):[(0,m.fA)(0,0,0),(0,m.fA)(0,0,s)],o=(0,Me.Nb)(r,a,i,16,!1),l=(0,Me.Nb)(r,a,i*de.UF,16,!1),c=xe(!1,r,i),h=xe(!0,r,i),d=(0,f.vt)();(0,v.kN)(d,a[a.length-1]),(0,v.lK)(d,d,(0,v.hM)(ze,Math.PI/2)),(0,v.lK)(d,d,(0,v.i1)(ze,Math.PI/2)),e&&(0,v.lK)(d,d,(0,v.hM)(ze,-n)),c.transformation=d,h.transformation=d,this.renderObjects=[new we.M(o,De.p7.Unfocused),new we.M(l,De.p7.Focused),new we.M(c,De.p7.Unfocused),new we.M(h,De.p7.Focused)];const u=(0,m.fA)(0,ke(!0),0),w=(0,_.h)(u,u,d),g=[...a,w];this.collisionType={type:"line",paths:[g]}}_createMaterial(){const e=new Ze.v({cullFace:He.s2.Back,renderOccluded:O.m$.OccludeAndTransparent,isDecoration:!0,writeLinearDepth:!0});return this._handles.add((0,a.wB)((()=>d.A.toUnitRGBA(this.view.effectiveTheme.accentColor)),(t=>e.setParameters({color:t})),a.Vh)),e}}function xe(e,t,i){const r=ke(e);let n=2*i;e&&(n*=de.UF);const s=r/2;return(0,Me._B)(t,r,s,s,n,0)}function ke(e){let t=fe;return e&&(t*=_e),t}const ze=(0,f.vt)();class Ge extends ye.c{constructor(e){super(),this._handles=new ce.A,this._interactive=!0,this._tool=e.tool,this._view=e.view,this._manipulatorHeading=new Fe(this._view,!0,5,ve),this._manipulatorTilt=new Fe(this._view,!0,5,ve),this._manipulatorDistance=new Fe(this._view,!1,5,ve),this.forEachManipulator((e=>{this._tool.manipulators.add(e),this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._manipulatorHeading=null,this._manipulatorTilt=null,this._manipulatorDistance=null,this._tool=null,this._view=null}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}createHeadingDragPipeline(e,t){return(0,Ae.Xt)(this._manipulatorHeading,((i,r,n,s,a)=>{const{_view:o}=this,l=Math.sin((0,p.kU)(t.tiltParallelToSurface))*t.farDistanceRenderSpace,c=(0,_.g)(Be,t.observerRenderSpace,(0,_.j)(Ne,t.upVector,l)),h=(0,_.b)(Ne,t.northVector,t.upVector),d=b(r,o,(0,he.f)(c,t.northVector,h)).next((e=>({...e,manipulatorType:ge.r.ROTATE})));e(i,d,n)}))}createTiltDragPipeline(e,t){return(0,Ae.Xt)(this._manipulatorTilt,((i,r,n,s,a)=>{const o=(0,he.f)(t.observerRenderSpace,t.targetDirection,t.tiltedUpVector),l=b(r,this._view,o).next((e=>({...e,manipulatorType:ge.r.ROTATE})));e(i,l,n)}))}createDistanceDragPipeline(e,t){return(0,Ae.Xt)(this._manipulatorDistance,((i,r,n,s,a)=>{const o=(0,Pe.fA)(t.observerRenderSpace,t.targetDirection),l=r.next((0,Ae.Tp)(this._view,i.location)).next((0,M.ov)(this._view,o)).next((e=>({...e,manipulatorType:ge.r.SCALE})));e(i,l,n)}))}updateManipulators(e){const{target:t}=e;this._manipulatorHeading.location=t,this._manipulatorTilt.location=t,this._manipulatorDistance.location=t;const i=(0,f.vt)(),r=e=>{(0,v.lw)(i,e,i)},n=function(e){const t=1,{verticalFieldOfView:i,horizontalFieldOfView:r}=e,n=i>180,s=r>180,a=e.farDistanceRenderSpace;if(n&&s)return Math.max(t,a);e.arcCentersPoints(a,Le);const{left:o,right:l,top:c,bottom:h}=Le,d=1.9*(n?(0,_.p)(o,l):s?(0,_.p)(h,o):Math.sqrt(Math.min((0,_.a)(h,c),(0,_.a)(o,l))));return Math.max(t,Math.min(a,d))}(e);r((0,v.CV)(Ue,(0,_.s)(Be,n,n,n))),r(V(e,Ue));const s=ve*de.UF*n,a=(0,_.j)(Be,e.targetDirection,s);r((0,v.kN)(Ue,a));const o=(0,v.N9)(Ue,-je);(0,v.lK)(o,o,(0,v.i1)(Ie,-je)),this._manipulatorHeading.modelTransform=(0,v.lK)((0,f.vt)(),i,o);const l=(0,v.i1)(Ue,je);(0,v.lK)(l,l,(0,v.N9)(Ie,Math.PI)),this._manipulatorTilt.modelTransform=(0,v.lw)((0,f.vt)(),i,l),this._manipulatorDistance.modelTransform=i}_updateManipulatorInteractivity(){const e=!this.grabbing;this.forEachManipulator((t=>{t.interactive=e&&this._interactive||t.grabbing}))}forEachManipulator(e){e(this._manipulatorHeading,ge.r.ROTATE),e(this._manipulatorTilt,ge.r.ROTATE),e(this._manipulatorDistance,ge.r.SCALE)}}const Le={top:(0,m.vt)(),bottom:(0,m.vt)(),left:(0,m.vt)(),right:(0,m.vt)()},Ue=(0,f.vt)(),Ie=(0,f.vt)(),Be=(0,m.vt)(),Ne=(0,m.vt)(),je=Math.PI/2;i(39299),i(15434),i(62754),i(50076);class $e extends me.q{constructor(e,t){super({view:e,autoScaleRenderObjects:!1,worldSized:!1,radius:5,interactive:!1}),this._handles=new ce.A;const i=(0,y.UM)(this._color);this.renderObjects=[new we.M((0,Me.CM)(i,5,32,32))],t.manipulators.add(this),this._handles.add([(0,a.wB)((()=>this._color),(e=>{i.setParameters({color:e})}),a.Vh)])}destroy(){this._handles.remove(),super.destroy()}get _color(){return d.A.toUnitRGBA(this.view.effectiveTheme.accentColor)}}(0,r._)([(0,o.MZ)()],$e.prototype,"_color",null);var We=i(14835),Ke=i(46947),qe=i(96999),Je=i(75655),Ye=i(1307),Xe=i(59833);const Qe=Symbol("dragHandles"),et=Symbol("hideManipulators");let tt=class extends n.A{constructor(e){super(e),this._moveManipulation=null,this._observerManipulator=null,this._fieldOfViewManipulation=null,this._scaleOrientManipulation=null,this._moveHelperVisualElement=null,this._settings=new We.w({getTheme:()=>this.view.effectiveTheme}),this._grabbing=!1,this.viewshedComputedData=null}initialize(){this._moveManipulation=this._createMoveManipulation(),this._fieldOfViewManipulation=new Oe({view:this.view,tool:this.parentTool}),this._scaleOrientManipulation=new Ge({view:this.view,tool:this.parentTool}),this._observerManipulator=new $e(this.view,this.parentTool),this._createMoveHelperVisuals(),this.addHandles([(0,a.wB)((()=>{const{observer:e}=this;return{observer:e,array:e?.toArray()}}),(e=>{let{observer:t}=e;null!=t&&(this._moveManipulation.location=t,this._observerManipulator.location=t)}),a.pc),(0,a.wB)((()=>{const{viewshedComputedData:e}=this;return{viewshedComputedData:e,observer:e?.observer}}),((e,t)=>{let{viewshedComputedData:i,observer:r}=e;this._grabbing&&r!==t?.observer||(this.removeHandles(Qe),i?.isValid()&&this.addHandles([this._buildObserverDragPipeline(i),this._buildFOVDragPipeline(i),this._buildScaleOrientDragPipeline(i)].filter(ae.Ru),Qe))}),a.Vh),(0,a.wB)((()=>{const e=this.viewshedComputedData;return e?.isValid()?{viewshedCompData:e,target:e.targetRenderSpace,hFOV:e.horizontalFieldOfView,vFOV:e.verticalFieldOfView}:null}),(e=>{null!=e&&this._fieldOfViewManipulation.updateManipulatorsTransform(e.viewshedCompData)}),a.Vh),(0,a.wB)((()=>{const e=this.viewshedComputedData;return e?.isValid()?{viewshedCompData:e,hFOV:e.horizontalFieldOfView,vFOV:e.verticalFieldOfView,tilt:e.tilt}:null}),(e=>{null!=e&&this._fieldOfViewManipulation.updateManipulatorVisuals(e.viewshedCompData)}),a.Vh),(0,a.wB)((()=>this.analysisViewData.visible&&(this.viewshedComputedData?.isValid()??!1)&&!this.parentTool.placingTarget),(e=>this._updateManipulationAvailability(e)),a.Vh),(0,a.wB)((()=>{const e=this.viewshedComputedData;if(!e?.isValid())return null;const{observer:t,target:i,verticalFieldOfView:r,horizontalFieldOfView:n}=e;return{viewshedCompData:e,observer:t,target:i,verticalFieldOfView:r,horizontalFieldOfView:n}}),(e=>{null!=e&&this._scaleOrientManipulation.updateManipulators(e.viewshedCompData)}),a.Vh),(0,a.wB)((()=>this.viewshedComputedData?.observerRenderSpace),(e=>{null!=e&&this._updateMoveHelperVisualsLocation(e)}),a.Vh)]);this._forEachManipulator((e=>{this.addHandles([e.events.on("focus-changed",(()=>this._updateManipulatorVisibility())),e.events.on("grab-changed",(e=>{this._grabbing="start"===e.action}))])}))}destroy(){this._moveManipulation=(0,s.pR)(this._moveManipulation),this._fieldOfViewManipulation=(0,s.pR)(this._fieldOfViewManipulation),this._scaleOrientManipulation=(0,s.pR)(this._scaleOrientManipulation),this.parentTool.manipulators.remove(this._observerManipulator),this._observerManipulator=(0,s.pR)(this._observerManipulator),this._destroyMoveHelperVisuals()}get viewshed(){return this.viewshedComputedData?.viewshed}get grabbing(){return this._grabbing}get observer(){return this.viewshed?.observer}set observer(e){const t=this.viewshed;null!=t&&(t.observer=e)}get discManipulator(){return this._moveManipulation.xyManipulation.discManipulator}onManipulatorSelectionChanged(){this._updateManipulatorVisibility()}hasManipulator(e){let t=!1;return this._forEachManipulator((i=>{t=t||i===e})),t}_someManipulatorSelected(){return this._moveManipulation.selected||this._fieldOfViewManipulation.selected||this._scaleOrientManipulation.selected}_someManipulatorHovering(){return this._moveManipulation.hovering||this._fieldOfViewManipulation.hovering||this._scaleOrientManipulation.hovering}_createMoveManipulation(){return new qe.v({view:this.view,tool:this.parentTool,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:Ke.HJ})}_buildObserverDragPipeline(e){const t=e.observer;return null==t?null:this._moveManipulation.createDragPipeline(((t,i,r,n,s)=>{n=n.next((0,Ae.VG)(this,["observer"]));const a=e.observer.clone();if(null==a)return{steps:r,cancel:n};const o=Xe.p.fromGeometry(a,(0,le.yX)(this.view.viewingMode));return{steps:r.next((0,Ae.Wp)({operations:o})).next((e=>(this.observer=(0,oe.project)(o.data.geometry,a.spatialReference),e))),cancel:n}}),{mode:"absolute-height",offset:0},t.spatialReference,void 0)}_buildFOVDragPipeline(e){let t=0,i=0;return this._fieldOfViewManipulation.createDragPipeline(((r,n,s)=>{if(null==e)return{steps:n,cancel:s};const a=e.viewshed;return s=s.next((0,Ae.VG)(e,["horizontalFieldOfView","verticalFieldOfView"])),{steps:n.next((r=>{"start"===r.action&&(t=e.horizontalFieldOfView,i=e.verticalFieldOfView);const n=r.deltaAngle;let s=0;switch(r.side){case"left":s=t/2-n;break;case"right":s=t/2+n;break;case"top":s=i+2*n;break;case"bottom":s=i-2*n}return Re(r.side)?(s=ee.ie.normalize(s),s=s>270?0:s>180?180:s,a.horizontalFieldOfView=2*s):a.verticalFieldOfView=s,r})),cancel:s}}),e)}_buildScaleOrientDragPipeline(e){let t=0,i=0;const r=(t,i)=>(r,n,s)=>{if(null==e)return{steps:n,cancel:s};const a=e.viewshed;return s=s.next((0,Ae.VG)(a,[t])),{steps:n=n.next(i(a,e)),cancel:s}};return(0,h.vE)([this._scaleOrientManipulation.createHeadingDragPipeline(r("heading",((t,r)=>r=>("start"===r.action&&(i=e.heading),t.heading=ee.ie.normalize(i+r.deltaAngle),r))),e),this._scaleOrientManipulation.createTiltDragPipeline(r("tilt",((i,r)=>r=>{"start"===r.action&&(t=e.tilt);let n=t+r.deltaAngle;return n<-90?n=180:n>270&&(n=0),i.tilt=rt.clamp(n),r})),e),this._scaleOrientManipulation.createDistanceDragPipeline(r("farDistance",((e,t)=>i=>{const r=(0,_.z)(it,i.renderEnd,t.observerRenderSpace),n=(0,_.H)(r)*t.metersPerUnit,s=(0,_.m)(r,t.targetDirection)<0?1:n;return e.farDistance=s,i})),e)])}_updateManipulationAvailability(e){this._moveManipulation.available=e,this._fieldOfViewManipulation.available=e,this._scaleOrientManipulation.available=e,this._observerManipulator.available=e}_updateManipulatorVisibility(){const e=this._someManipulatorSelected()||this._someManipulatorHovering()&&null==this.view.activeTool;if(e)this.removeHandles(et);else{const e=[],t=t=>{e.push(t.disableDisplay())};this._forEachManipulator(t),this.addHandles(e,et)}this._updateMoveHelperVisualsVisibility(e)}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),this._fieldOfViewManipulation.forEachManipulator(e),this._scaleOrientManipulation.forEachManipulator(e),e(this._observerManipulator)}_createMoveHelperVisuals(){this._destroyMoveHelperVisuals();const e=new Ye.o({view:this.view,attached:!0,style:{glowWidth:this._settings.visualElements.heightPlane.glowWidth,innerWidth:this._settings.visualElements.heightPlane.innerWidth},isDecoration:!0}),t=new Je.U({view:this.view,extensionType:this._settings.visualElements.zVerticalLine.extensionType,attached:!0,innerWidth:1,writeDepthEnabled:!1,renderOccluded:O.m$.OccludeAndTransparent,isDecoration:!0});this._moveHelperVisualElement={laserline:e,verticalLine:t},this.addHandles([(0,a.wB)((()=>this._settings.visualElements.zVerticalLine),(e=>e.apply(t)),a.pc),(0,a.wB)((()=>this._settings.visualElements.heightPlane),(t=>t.apply(e)),a.pc)])}_updateMoveHelperVisualsVisibility(e){e=this.analysisViewData.visible&&e;const t=this._moveHelperVisualElement;null!=t&&(t.verticalLine.visible=e,t.laserline.visible=e)}_updateMoveHelperVisualsLocation(e){const t=this._moveHelperVisualElement;if(null==t)return;const{laserline:i,verticalLine:r}=t;i.heightManifoldTarget=e,i.intersectsWorldUpAtLocation=e,null!=e&&r.setStartEndFromWorldDownAtLocation(e)}_destroyMoveHelperVisuals(){const e=this._moveHelperVisualElement;null!=e&&(e.laserline.destroy(),e.verticalLine.destroy(),this._moveHelperVisualElement=null)}get test(){return{moveManipulation:this._moveManipulation,fieldOfViewManipulation:this._fieldOfViewManipulation,scaleOrientManipulation:this._scaleOrientManipulation,moveHelperVisualElements:this._moveHelperVisualElement,viewshedComputedData:this.viewshedComputedData}}};(0,r._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"analysis",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],tt.prototype,"parentTool",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],tt.prototype,"view",void 0),(0,r._)([(0,o.MZ)()],tt.prototype,"viewshed",null),(0,r._)([(0,o.MZ)()],tt.prototype,"_grabbing",void 0),(0,r._)([(0,o.MZ)()],tt.prototype,"grabbing",null),(0,r._)([(0,o.MZ)()],tt.prototype,"viewshedComputedData",void 0),(0,r._)([(0,o.MZ)()],tt.prototype,"observer",null),tt=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedSubTool")],tt);const it=(0,m.vt)(),rt=new ee.hr(0,180);var nt,st=i(5109),at=i(82307),ot=i(46576),lt=i(11500);let ct=nt=class extends st.k{constructor(e){super(e),this.removeIncompleteOnCancel=!1,this.automaticManipulatorSelection=!1,this._stagedViewshed=null,this._stagedViewshedComputedData=null,this._creating=!1,this._selectedManipulator=null,this._selectedManipulatorSubTool=null}initialize(){this._intersector=(0,ot.T)(this.view.state.viewingMode);const e=this.analysisViewData.viewshedComputedDataHandles;this.addHandles([(0,a.wB)((()=>e.some((e=>e.viewshedComputedData.isValid()))),(e=>{e&&this.finishToolCreation()}),a.pc),(0,a.wB)((()=>this._stagedViewshed),(e=>{this._stagedViewshedComputedData=null!=e?this.analysisViewData.viewshedComputedDataHandles.find((t=>t.viewshedComputedData.viewshed===e))?.viewshedComputedData:null}),a.pc),(0,a.wB)((()=>this.firstGrabbedManipulator),(e=>{null!=e&&this._selectManipulator(e)}),a.OH),(0,a.wB)((()=>this.analysisViewData.visible),(e=>{e||this._selectManipulator(null)})),(0,a.wB)((()=>this.view.activeTool),(e=>{e!==this&&null!=e&&this._selectManipulator(null)}))]),this.subToolHandles=(0,a.LF)((()=>e),(e=>{let{viewshedComputedData:t}=e;const i=new tt({analysis:this.analysis,analysisViewData:this.analysisViewData,parentTool:this,view:this.view,viewshedComputedData:t});return{subTool:i,remove:()=>{this._selectedManipulatorSubTool===i&&this._selectManipulator(null),i.destroy()}}}))}destroy(){this.subToolHandles=(0,s.pR)(this.subToolHandles)}onDeactivate(){this.removeStaged()}get cursor(){return this.creating?"crosshair":null}_selectManipulator(e){const t=this._selectedManipulator;null!=t&&(t.selected=!1,this._selectedManipulator=null,this._selectedManipulatorSubTool?.onManipulatorSelectionChanged(),this._selectedManipulatorSubTool=null),null!=e&&(e.selected=!0,this._selectedManipulator=e,this._selectedManipulatorSubTool=this.subToolHandles.find((t=>t.subTool.hasManipulator(e)))?.subTool,this._selectedManipulatorSubTool?.onManipulatorSelectionChanged())}get selectedViewshed(){return this._selectedManipulatorSubTool?.viewshed}set selectedViewshed(e){this.selectViewshed(e)}get selectedViewshedComputedData(){return this._selectedManipulatorSubTool?.viewshedComputedData}get stagedViewshed(){return this._stagedViewshed}get grabbing(){return this.subToolHandles.some((e=>{let{subTool:t}=e;return t.grabbing}))}get creating(){return this._creating&&this.active}get placingTarget(){return null!=this._stagedViewshed}createViewsheds(){this._creating=!0}onManipulatorSelectionChanged(){this.subToolHandles.forEach((e=>e.subTool.onManipulatorSelectionChanged()))}onInputEvent(e){switch(e.type){case"immediate-click":this._clickDeselectHandler();break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":at.NE.cancel===e.key?this._cancelKeyHandler(e):at.NE.delete.includes(e.key)&&this._deleteKeyHandler()}}onInputEventAfter(e){"immediate-click"===e.type&&this._clickPlacementHandler(e)}_clickDeselectHandler(){this.hasFocusedManipulators||this._selectManipulator(null)}_clickPlacementHandler(e){if(!this.creating||this.hasFocusedManipulators)return;const t=this._stagedViewshed,i=this._intersectScreen(e,_t);if(null!=i){if(null==t){i.mapPoint.z=(i.mapPoint.z??0)+2;const e=new ne({observer:i.mapPoint.clone()});this.analysis.viewsheds.add(e),this._stagedViewshed=e,this._updateStagedViewshed(i.scenePoint)}else{this._updateStagedViewshed(i.scenePoint);const e=this._stagedViewshed;this._stagedViewshed=null,this.selectViewshed(e)}e.stopPropagation()}}_doubleClickHandler(e){this.creating&&(this.removeStaged(),this._selectManipulator(null),this._creating=!1,this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(!this.creating||null==this._stagedViewshed)return;const t=this._intersectScreen(e,_t);null!=t&&this._updateStagedViewshed(t.scenePoint)}_cancelKeyHandler(e){if(this.creating){if(this.removeStaged())return this._selectManipulator(null),void e.stopPropagation();this._creating=!1}else if(!this.grabbing)return this.selectViewshed(null),void e.stopPropagation()}_deleteKeyHandler(){this.creating&&this.removeStaged(),null!=this.selectedViewshed&&this.analysis.viewsheds.remove(this.selectedViewshed)}_updateStagedViewshed(e){const t=this._stagedViewshed,i=this._stagedViewshedComputedData;if(null==t||null==i)return;const{heading:r,tilt:n,farDistance:s}=function(e,t,i){const r=t.observerRenderSpace,n=(0,_.z)(ht,i,r),s=(0,_.H)(n)*t.metersPerUnit,a=e.renderCoordsHelper.basisMatrixAtPosition(r,vt),o=(0,_.s)(dt,a[8],a[9],a[10]),l=(0,se.O_)(r,o,ft),c=(0,se._I)(l,i,ut),h=(0,_.z)(c,c,r),d=(0,p.KJ)((0,_.d)(n,h))*((0,_.m)(o,n)<0?-1:1)+90,u=(0,_.s)(pt,a[4],a[5],a[6]),v=(0,p.KJ)((0,_.d)(u,h)),f=(0,_.s)(pt,a[0],a[1],a[2]);return{heading:(0,_.m)(h,f)<0?360-v:v,tilt:d,farDistance:s}}(this.view,i,e);t.farDistance=s,t.tilt=n,t.heading=r}removeStaged(){return null!=this._stagedViewshed&&(this.analysis.viewsheds.remove(this._stagedViewshed),this._stagedViewshed=null,!0)}selectViewshed(e){if(null!=e)for(const i of this.view.tools.items)i!==this&&i instanceof nt&&i.selectViewshed(null);const t=this.subToolHandles.find((t=>t.subTool.viewshed===e))?.subTool;this._selectManipulator(t?.discManipulator)}_intersectScreen(e,t){const i=(0,lt.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const r=this._intersector.results.min,n=t.scenePoint;if(!r.getIntersectionPoint(n))return null;const s=t.mapPoint;return s.spatialReference=this.view.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(n,s),null==s?null:t}get test(){return{subTools:this.subToolHandles.map((e=>e.subTool.test)),selectedSubTool:this._selectedManipulatorSubTool?.test,stagedViewshed:this._stagedViewshed}}};(0,r._)([(0,o.MZ)({constructOnly:!0})],ct.prototype,"view",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"analysisViewData",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"removeIncompleteOnCancel",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0})],ct.prototype,"analysis",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"subToolHandles",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_stagedViewshed",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_stagedViewshedComputedData",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_creating",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],ct.prototype,"cursor",null),(0,r._)([(0,o.MZ)()],ct.prototype,"_selectedManipulator",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"_selectedManipulatorSubTool",void 0),(0,r._)([(0,o.MZ)()],ct.prototype,"selectedViewshed",null),(0,r._)([(0,o.MZ)()],ct.prototype,"selectedViewshedComputedData",null),(0,r._)([(0,o.MZ)()],ct.prototype,"grabbing",null),(0,r._)([(0,o.MZ)()],ct.prototype,"creating",null),(0,r._)([(0,o.MZ)()],ct.prototype,"placingTarget",null),ct=nt=(0,r._)([(0,l.$)("esri.views.3d.analysis.Viewshed.ViewshedTool")],ct);const ht=(0,m.vt)(),dt=(0,m.vt)(),ut=(0,m.vt)(),pt=(0,m.vt)(),vt=(0,f.vt)(),ft=(0,se.vt)(),_t={mapPoint:new Z.A,scenePoint:(0,m.vt)()},mt=ct;var wt=i(92290),gt=i(10260);let yt=class extends((0,c.P)(n.A)){constructor(e){super(e),this.type="viewshed-view-3d",this.analysis=null,this.tool=null,this.viewshedComputedDataHandles=null,this._placementTask=null}get selectedViewshed(){return this.tool?.selectedViewshed}set selectedViewshed(e){const{tool:t}=this;null!=t&&(t.selectedViewshed=e)}get selectedViewshedComputedData(){return this.tool?.selectedViewshedComputedData}initialize(){this._initializeUpdateHandle(),this.viewshedComputedDataHandles=(0,a.LF)((()=>this.analysis.viewsheds),(e=>{const t=new F({renderCoordsHelper:this.view.renderCoordsHelper,viewshed:e}),i=Symbol();return this.addHandles((0,a.wB)((()=>t.isValid()),((e,i)=>{this.visible&&(e?this._addViewshedsToRenderer(t):i&&this._removeViewshedsFromRenderer(t))}),a.Vh)),{viewshedComputedData:t,remove:()=>{this.removeHandles(i),this._removeViewshedsFromRenderer(t),t.destroy()}}})),this._analysisVisualization=new P({view:this.view,analysisViewData:this,isDecoration:!this.parent}),this.addHandles([(0,a.wB)((()=>this.visible),(e=>{const t=this.viewshedComputedDataHandles.map((e=>e.viewshedComputedData)).filter((e=>e.isValid()));e?this._addViewshedsToRenderer(t):this._removeViewshedsFromRenderer(t)})),(0,a.wB)((()=>this.view.renderCoordsHelper),(e=>{this.viewshedComputedDataHandles.forEach((t=>{let{viewshedComputedData:i}=t;return i.renderCoordsHelper=e}))})),(0,gt.Hd)(this,mt)])}destroy(){this._placementTask=(0,s.DC)(this._placementTask),(0,gt.aS)(this),this._analysisVisualization=(0,s.pR)(this._analysisVisualization),this._removeViewshedsFromRenderer(this.viewshedComputedDataHandles.map((e=>e.viewshedComputedData)))}async createViewsheds(e){return this._placementTask=(0,s.DC)(this._placementTask),this._placementTask=(0,gt.JY)(this,e),null!=this.tool&&this.tool.createViewsheds(),await this._placementTask.promise}_initializeUpdateHandle(){const e=this.view._stage.renderer.plugins.plugins.find((e=>e instanceof wt.S));e&&(this._updateHandleInRenderer=e.updateViewsheds.bind(e))}_addViewshedsToRenderer(e){this._updateHandleInRenderer({adds:e})}_removeViewshedsFromRenderer(e){this._updateHandleInRenderer({removes:e})}};(0,r._)([(0,o.MZ)({readOnly:!0})],yt.prototype,"type",void 0),(0,r._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],yt.prototype,"analysis",void 0),(0,r._)([(0,o.MZ)()],yt.prototype,"tool",void 0),(0,r._)([(0,o.MZ)()],yt.prototype,"selectedViewshed",null),(0,r._)([(0,o.MZ)()],yt.prototype,"selectedViewshedComputedData",null),(0,r._)([(0,o.MZ)()],yt.prototype,"viewshedComputedDataHandles",void 0),(0,r._)([(0,o.MZ)()],yt.prototype,"_analysisVisualization",void 0),(0,r._)([(0,o.MZ)()],yt.prototype,"_placementTask",void 0),yt=(0,r._)([(0,l.$)("esri.views.3d.analysis.ViewshedAnalysisView3D")],yt);const Mt=yt},7256:(e,t,i)=>{i.d(t,{t:()=>u});var r=i(34761),n=i(13191),s=i(20664),a=i(9392),o=i(55855),l=i(32314),c=i(70667),h=i(45463),d=i(425);class u extends l.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._hasExternalMaterial=null!=t,this._material=null!=t?t:new d.W({width:1,color:(0,o.fA)(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:h.m$.OccludeAndTransparent,isDecoration:!!e.isDecoration,writeDepth:!0}),this.applyProperties(e)}setGeometryFromRenderSpacePoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.geometry=[[[e[0]-t,e[1],e[2]],[e[0]+t,e[1],e[2]]],[[e[0],e[1]-t,e[2]],[e[0],e[1]+t,e[2]]],[[e[0],e[1],e[2]-t],[e[0],e[1],e[2]+t]]]}setGeometryFromExtent(e){const t=this.view.spatialReference,i=(0,a.vt)(),r=(0,a.vt)(),n=100,o=[];(0,s.s)(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,s.s)(i,e[2],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,s.s)(i,e[2],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,s.s)(i,e[0],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,s.s)(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),(0,s.s)(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),this.geometry=[o]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,r=e.basis1,n=e.basis2,s=.5,o=(0,a.vt)(),l=(0,a.vt)(),c=(0,a.vt)(),h=(0,a.vt)();o[0]=i[0]-r[0]*s-n[0]*s,o[1]=i[1]-r[1]*s-n[1]*s,o[2]=i[2]-r[2]*s-n[2]*s,l[0]=i[0]-r[0]*s+n[0]*s,l[1]=i[1]-r[1]*s+n[1]*s,l[2]=i[2]-r[2]*s+n[2]*s,c[0]=i[0]+r[0]*s+n[0]*s,c[1]=i[1]+r[1]*s+n[1]*s,c[2]=i[2]+r[2]*s+n[2]*s,h[0]=i[0]+r[0]*s-n[0]*s,h[1]=i[1]+r[1]*s-n[1]*s,h[2]=i[2]+r[2]*s-n[2]*s,t.push([o[0],o[1],o[2]]),t.push([l[0],l[1],l[2]]),t.push([c[0],c[1],c[2]]),t.push([h[0],h[1],h[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=(0,r.kN)(p,t);const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.uY;this.transform=(0,r.kN)(p,t),this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}getTransformedGeometry(){return null==this._geometry?null:this._geometry.map((e=>e.map((e=>(0,s.h)((0,a.vt)(),e,this.transform)))))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(e){this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(e){this._material.setParameters({width:e})}get color(){return this._material.parameters.color}set color(e){const t=1===e[3];this._material.setParameters({color:(0,o.o8)(e),writeDepth:t})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(e){this._material.setParameters({innerWidth:e})}get innerColor(){return this._material.parameters.innerColor}set innerColor(e){this._material.setParameters({innerColor:null!=e?(0,o.o8)(e):null})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(e){null!=this._material&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(e){this._material.setParameters({stippleOffColor:null!=e?(0,o.o8)(e):null})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(e){this._material.setParameters({stipplePreferContinuous:e})}get falloff(){return this._material.parameters.falloff}set falloff(e){this._material.setParameters({falloff:e})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(e){this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){}destroyExternalResources(){}createGeometries(e){for(const t of(0,c.z)(this.geometry)){const i=(0,c.t)(this._material,t);e.addGeometry(i)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const p=(0,n.vt)()},10260:(e,t,i)=>{i.d(t,{Hd:()=>l,JY:()=>o,aS:()=>c});var r=i(98773),n=i(30726),s=i(50346),a=i(68134);function o(e,t){e.interactive=!0;const{tool:i,view:o}=e;o.activeTool=i;let l=(0,s.u7)(t,(()=>{o.activeTool===i&&(o.activeTool=null)}));return(0,r.UT)((async e=>{await(0,a.C_)((()=>null==i||!i.active),e),l=(0,n.xt)(l)}),t)}function l(e,t){return(0,a.wB)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){c(e);const{view:i,analysis:r}=e,n=new t({view:i,analysis:r,analysisViewData:e});e.tool=n,i.tools.add(n)}(e,t):c(e)}(e,t)),a.pc)}function c(e){const{view:t,tool:i}=e;null!=i&&(t.tools.remove(i),e.tool=null)}},5109:(e,t,i)=>{i.d(t,{k:()=>o});var r=i(35143),n=i(68134),s=(i(76460),i(81806),i(47249),i(50076),i(85842)),a=i(56829);let o=class extends a.g{constructor(e){super(e)}initialize(){this.addHandles((0,n.wB)((()=>this.analysisViewData.visible),(e=>this.visible=e),n.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};o=(0,r._)([(0,s.$)("esri.views.interactive.AnalysisToolBase")],o)},46576:(e,t,i)=>{i.d(t,{T:()=>s});var r=i(29808),n=i(3112);function s(e){const t=(0,r.hz)(e);return t.options.store=n.oH.MIN,t.options.hud=!1,t}},82307:(e,t,i)=>{i.d(t,{NE:()=>l,TU:()=>d,ac:()=>h,fn:()=>c,oe:()=>u});var r=i(18690),n=i(54901),s=i(87663),a=i(57308),o=i(41036);const l={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},c={toggle:"Control"},h={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},d={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:o.i,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:"z",redo:"r"};class u{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,(e=>{"key-down"===e.type&&t(e)}))}addToggle(e,t){const i=p.fromDefinition(e,t),a=(0,s.tE)(this._bindings,i.key,(()=>[]));return a.push(i),(0,n.hA)((()=>(0,r.TF)(a,i)))}register(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.o.WIDGET;return(0,n.vE)([e.on("key-down",(t=>this.dispatch(e.inputManager,t)),t),e.on("key-up",(t=>this.dispatch(e.inputManager,t)),t)])}dispatch(e,t){const i=t.key,r=this._bindings.get(i);if(r)for(const n of r)n.process(e,t)}}class p{constructor(e,t,i,r,n){this.key=e,this.modifiers=t,this.repeats=i,this.continuePropagation=r,this.callback=n}process(e,t){if(!(t.key!==this.key||"repeat"in t&&t.repeat&&!this.repeats)){for(const t of this.modifiers)if(!e.isModifierKeyDown(t))return;this.continuePropagation||t.stopPropagation(),this.callback(t)}}static fromDefinition(e,t){if("string"==typeof e)return new p(e,[],!1,!1,t);const{key:i,modifier:r,repeats:n,continuePropagation:s}=e;return new p(i,r?Array.isArray(r)?r:[r]:[],!!n,!!s,t)}}},74050:(e,t,i)=>{i.d(t,{Dh:()=>l,IB:()=>h,Vv:()=>r,fg:()=>o,jI:()=>c});i(15941);var r,n=i(19555),s=i(72745);function a(e,t){return e[0]*t[1]-e[1]*t[0]}function o(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;return(0,n.Re)(u,r,i),(0,n.Re)(v,t,s),function(e,t,i){const r=(0,n.Om)(i,t)/(0,n.m3)(i);(0,n.hs)(e,i,r)}(f,v,u),(0,n.WQ)(e,s,f)}function l(e,t,i,r){(0,n.Re)(u,t,i);const s=r/(0,n.Bw)(u);return(0,n.Ln)(e,i,u,s)}function c(e,t){const i=e.start,s=e.end,o=t.start,l=t.end,c=(0,n.Re)(u,s,i),h=(0,n.Re)(p,l,o),_=a(c,h);if(Math.abs(_)<=d)return[];const m=(0,n.Re)(v,i,o),w=a(h,m)/_,g=a(c,m)/_;if(w>=0){if(g>=0||t.type===r.LINE)return[(0,n.Ln)(f,i,c,w)]}else if(e.type===r.LINE&&(g>=0||t.type===r.LINE))return[(0,n.Ln)(f,i,c,w)];return[]}function h(e,t,i){const s=[],a=(0,n.Re)(u,e.end,e.start),o=(0,n.Re)(p,e.start,t),l=(0,n.m3)(a),c=2*(0,n.Om)(a,o),h=c*c-4*l*((0,n.m3)(o)-i*i);if(0===h){const t=-c/(2*l);(e.type===r.LINE||t>=0)&&s.push((0,n.Ln)(f,e.start,a,t))}else if(h>0){const t=Math.sqrt(h),i=(-c+t)/(2*l);(e.type===r.LINE||i>=0)&&s.push((0,n.Ln)(f,e.start,a,i));const o=(-c-t)/(2*l);(e.type===r.LINE||o>=0)&&s.push((0,n.Ln)(v,e.start,a,o))}return s}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(r||(r={}));const d=1e-6,u=(0,s.vt)(),p=(0,s.vt)(),v=(0,s.vt)(),f=(0,s.vt)()}}]);
//# sourceMappingURL=8255.f9c3b586.chunk.js.map